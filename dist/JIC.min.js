!function(t,e){"object"==typeof exports?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t)}(this,function(t){var e={compress:function(t,e,n){var a="image/jpeg";"undefined"!=typeof n&&"png"==n&&(a="image/png");var o=document.createElement("canvas");o.width=t.naturalWidth,o.height=t.naturalHeight;var r=(o.getContext("2d").drawImage(t,0,0),o.toDataURL(a,e/100)),i=new Image;return i.src=r,i},upload:function(t,e,n,a,o,r,i,s){var u=document.createElement("canvas");u.width=t.naturalWidth,u.height=t.naturalHeight;u.getContext("2d").drawImage(t,0,0);void 0===XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(t){var e=Array.prototype.map.call(t,function(t){return 255&t.charCodeAt(0)});this.send(new Uint8Array(e).buffer)});var d="image/jpeg";".png"==a.substr(-4)&&(d="image/png");var p=u.toDataURL(d);p=p.replace("data:"+d+";base64,","");var c=new XMLHttpRequest;c.open("POST",e,!0);var f="someboundary";if(c.setRequestHeader("Content-Type","multipart/form-data; boundary="+f),s&&"object"==typeof s)for(var g in s)c.setRequestHeader(g,s[g]);i&&i instanceof Function&&(c.onprogress=function(t){return t.lengthComputable?t.loaded/t.total*100:void 0}),c.sendAsBinary(["--"+f,'Content-Disposition: form-data; name="'+n+'"; filename="'+a+'"',"Content-Type: "+d,"",atob(p),"--"+f+"--"].join("\r\n")),c.onreadystatechange=function(){4==this.readyState&&(200==this.status?o(this.responseText):this.status>=400&&r&&r instanceof Function&&r(this.responseText))}}};return t.jic=e,e});